// --- æ ¸å¿ƒï¼šç”¢ç”Ÿ Word (ä¿®æ”¹ç‰ˆï¼šå¾ Supabase æŠ“ç¯„æœ¬) ---
        async function generateWord() {
            const btn = document.querySelector('button.action-btn');
            btn.innerText = "è™•ç†ä¸­...";
            btn.disabled = true;

            try {
                // 1. å¾ Supabase Storage ä¸‹è¼‰ Template
                // å‡è¨­ bucket åç¨±æ˜¯ 'system_files'ï¼Œæª”åæ˜¯ 'template.docx'
                const { data: fileData, error: downloadError } = await supabase
                    .storage
                    .from('system_files') // â˜…â˜…â˜… è«‹ç¢ºèªä½ çš„ bucket åç¨± â˜…â˜…â˜…
                    .download('template.docx');

                if (downloadError) throw new Error("ç„¡æ³•ä¸‹è¼‰åˆç´„ç¯„æœ¬ï¼Œè«‹ç¢ºèªå·²ç™»å…¥æˆ–æª”æ¡ˆå­˜åœ¨ã€‚");
                
                // å°‡ Blob è½‰ç‚º ArrayBuffer
                const content = await fileData.arrayBuffer();

                // 2. æº–å‚™è³‡æ–™
                const visitDate = document.getElementById('visit_date').value;
                const data = {
                    user_name: document.getElementById('user_name').value,
                    user_id: document.getElementById('user_id').value,
                    user_phone: document.getElementById('user_phone').value,
                    payment: document.getElementById('payment').value,
                    contractor_name: document.getElementById('contractor_name').value,
                    contractor_phone: document.getElementById('contractor_phone').value,
                    household_address: document.getElementById('household_address').value,
                    contact_address: document.getElementById('contact_address').value,
                    visit_date: visitDate,
                    end_date: calculateEndDate(visitDate)
                };

                // 3. æ¸²æŸ“ Word
                const zip = new PizZip(content);
                const doc = new window.docxtemplater(zip, {
                    paragraphLoop: true,
                    linebreaks: true,
                });

                doc.render(data);

                // 4. ä¸‹è¼‰çµæœ
                const blob = doc.getZip().generate({
                    type: "blob",
                    mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                });
                
                const fileName = `ç¾©å¤§é†«é™¢å¥‘ç´„æ›¸_${data.user_name}.docx`;
                saveAs(blob, fileName);
                
            } catch (error) {
                alert("ç”¢ç”Ÿå¤±æ•—ï¼š" + error.message);
                console.error(error);
            } finally {
                btn.innerText = "ğŸ“ ä¸‹è¼‰ Word å¥‘ç´„æ›¸";
                btn.disabled = false;
            }
        }
