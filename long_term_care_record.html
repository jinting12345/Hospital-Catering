<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»çµ±è¨ºæ–·æ¨¡å¼ (CMS & ååš¥)</title>
    <script src="https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #2c3e50; color: #fff; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 400px; background: #000; color: #0f0; padding: 15px; border: 2px solid #f1c40f; font-size: 14px; line-height: 1.6; }
        button { padding: 15px 30px; font-size: 18px; background: #3498db; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 20px; }
        h2 { color: #f1c40f; border-bottom: 1px solid #7f8c8d; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ CMS èˆ‡ ååš¥ åŸå§‹ç¢¼è¨ºæ–·</h1>
        <p>è«‹ä¸Šå‚³ PDFï¼Œç³»çµ±æœƒåˆ—å‡ºæ‰€æœ‰ç›¸é—œçš„æ–‡å­—ç‰‡æ®µã€‚</p>
        <input type="file" id="pdf_upload" accept="application/pdf" style="margin-bottom: 20px;">
        <button onclick="runDebug()">â–¶ï¸ é–‹å§‹è¨ºæ–·</button>
        
        <h2>è¨ºæ–·å ±å‘Š (è«‹è¤‡è£½ä¸‹æ–¹å…§å®¹)</h2>
        <textarea id="debug_log" readonly>ç­‰å¾…åŸ·è¡Œ...</textarea>
    </div>

<script>
    if (window.pdfjsLib) {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.worker.min.js';
    }

    function log(msg) { 
        const el = document.getElementById('debug_log');
        el.value += msg + "\n";
        el.scrollTop = el.scrollHeight;
    }

    // ä¸åšä»»ä½•æ¸…ç†ï¼Œä¿ç•™æœ€åŸå§‹çš„ç©ºç™½èˆ‡æ›è¡Œï¼Œæ‰èƒ½çœ‹å‡ºç¬¦è™Ÿä½ç½®
    async function runDebug() {
        const fileInput = document.getElementById('pdf_upload');
        if (fileInput.files.length === 0) { alert("è«‹å…ˆé¸æ“‡ PDF!"); return; }
        
        document.getElementById('debug_log').value = "=== è¨ºæ–·é–‹å§‹ ===\n";
        
        try {
            const file = fileInput.files[0];
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;

            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                // é€™è£¡æˆ‘å€‘ä¿ç•™æ›è¡Œç¬¦è™Ÿï¼Œç”¨ | åˆ†éš”ï¼Œä»¥ä¾¿è§€å¯Ÿæ’ç‰ˆ
                fullText += textContent.items.map(item => item.str).join("|"); 
            }

            log(`PDF ç¸½é•·åº¦: ${fullText.length} å­—å…ƒ\n`);

            // === è¨ºæ–· 1: CMS ç­‰ç´š ===
            log("--- [CMS ç­‰ç´š] æœå°‹çµæœ ---");
            // æœå°‹æ‰€æœ‰å‡ºç¾ "CMS" çš„åœ°æ–¹
            let cmsRegex = /CMS/g;
            let match;
            let count = 0;
            while ((match = cmsRegex.exec(fullText)) !== null) {
                count++;
                // æŠ“å–å‰å¾Œ 100 å€‹å­—
                let start = Math.max(0, match.index - 50);
                let end = Math.min(fullText.length, match.index + 100);
                log(`\nã€ç¬¬ ${count} è™• CMSã€‘:`);
                log(fullText.substring(start, end));
            }
            if (count === 0) log("âŒ æ‰¾ä¸åˆ° 'CMS' é—œéµå­—");

            // === è¨ºæ–· 2: ååš¥å›°é›£ (G6a) ===
            log("\n--- [ååš¥å›°é›£ G6a] æœå°‹çµæœ ---");
            // æœå°‹ "G6a" æˆ– "ååš¥"
            let swallowIndex = fullText.indexOf("G6a");
            if (swallowIndex === -1) swallowIndex = fullText.indexOf("ååš¥èƒ½åŠ›");
            
            if (swallowIndex !== -1) {
                // æŠ“å–æ¯”è¼ƒé•·çš„ç¯„åœï¼Œçœ‹çœ‹å‹¾é¸ç¬¦è™Ÿåœ¨å“ªè£¡
                let start = swallowIndex;
                let end = Math.min(fullText.length, swallowIndex + 1500);
                let content = fullText.substring(start, end);
                log(content);
                
                log("\n--- æª¢æŸ¥ç‰¹æ®Šç¬¦è™Ÿ ---");
                if (content.includes("â˜‘")) log("âœ… ç™¼ç¾ 'â˜‘' ç¬¦è™Ÿ");
                else log("âŒ æ²’ç™¼ç¾ 'â˜‘' ç¬¦è™Ÿ");
                
                if (content.includes("â– ")) log("âœ… ç™¼ç¾ 'â– ' ç¬¦è™Ÿ");
                if (content.includes("âœ“")) log("âœ… ç™¼ç¾ 'âœ“' ç¬¦è™Ÿ");
                
                // æª¢æŸ¥ '3.åƒ' é™„è¿‘
                let eatIndex = content.indexOf("3.åƒ");
                if (eatIndex !== -1) {
                    log(`\n'3.åƒ' å‰é¢çš„ 20 å€‹å­—å…ƒ: [${content.substring(eatIndex - 20, eatIndex)}]`);
                }
            } else {
                log("âŒ æ‰¾ä¸åˆ° 'G6a' æˆ– 'ååš¥èƒ½åŠ›' é—œéµå­—");
            }

            log("\n=== è¨ºæ–·çµæŸ ===");

        } catch (err) {
            log("éŒ¯èª¤: " + err.message);
        }
    }
</script>
</body>
</html>
